<!DOCTYPE html>

<html>
<head>
  <title>answer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="answer.html">
                answer.js
              </a>
            
              
              <a class="source" href="collect.html">
                collect.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="answer-js">answer.js</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="in-this-file-you-can-find-functions-to-shuffle-participants-and-create-nice-messages-which-will-be-sent">In this file you can find functions to shuffle participants and create nice messages which will be sent</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><em>You can run this file like this: node answer.js input.js
Where the lines of input.js look like this:</em></p>
<pre><code>
var store={
'USERNAME1':'HH:MM',
'USERNAME2':'HH:MM',
'USERNAME3':'HH:MM'
}
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Functions to help using other js file
where the store JSON string is located</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span><span class="hljs-params">(f)</span> </span>{
  <span class="hljs-keyword">return</span> fs.readFileSync(f).toString();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">include</span><span class="hljs-params">(f)</span> </span>{
  <span class="hljs-built_in">eval</span>.apply(global, [read(f)]);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>String formatting method to easily insert strings.
Source: <a href="http://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format">http://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">String</span>.prototype.format) {
  <span class="hljs-built_in">String</span>.prototype.format = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.replace(<span class="hljs-regexp">/{(\d+)}/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(match, number)</span> </span>{ 
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> args[number] != <span class="hljs-string">'undefined'</span>
        ? args[number]
        : match
      ;
    });
  };
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Participants are stored in an array, they are shuffled randomly for the roulette. 
Source: <a href="http://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array-in-javascript">http://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array-in-javascript</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shuffle</span><span class="hljs-params">(o)</span></span>{ <span class="hljs-comment">//v1.0</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j, x, i = o.length; i; j = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    <span class="hljs-keyword">return</span> o;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>This is a helper function to shuffle the arrays associated with the time-keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shuffleTimeArray</span><span class="hljs-params">(time_array)</span>
</span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> time_array)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Calling shuffle multiple times, because in practice
it seems that calling shuffle only once is not that random what we wanted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		time_array[key]=shuffle(time_array[key]);
		time_array[key]=shuffle(time_array[key]);
		time_array[key]=shuffle(time_array[key]);
	}
	<span class="hljs-keyword">return</span> time_array;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>This is the answer formatting method.
Participants receive a message if paired:
‘Hey @someone! You are paired up with @someone2 and @someone3 for lunch. Let’s meet them at 12:45. Bon appétit!’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMsg</span><span class="hljs-params">(name_list,time)</span>
</span>{
	<span class="hljs-keyword">var</span> i;
	<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;name_list.length;i++)
	{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The others array contains the people in the group besides the addressed person.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> others=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
		<span class="hljs-keyword">var</span> j;
		<span class="hljs-keyword">for</span> (j=<span class="hljs-number">0</span>;j&lt;name_list.length;j++)
		{
			<span class="hljs-keyword">if</span> (i!==j)
			{
				others.push(name_list[j]);
			}
		}
		<span class="hljs-keyword">var</span> msg=<span class="hljs-string">"Hey {0}! You are paired up with"</span>.format(name_list[i]);
		<span class="hljs-keyword">if</span> (others.length&gt;<span class="hljs-number">1</span>)
		{
			<span class="hljs-keyword">for</span> (j=<span class="hljs-number">0</span>;j&lt;others.length;j++)
			{
				<span class="hljs-keyword">if</span> (j===others.length-<span class="hljs-number">1</span>)
				{
					msg+=<span class="hljs-string">' and {0}'</span>.format(others[j]);
				}
				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (j===others.length-<span class="hljs-number">2</span>) {
					msg+=<span class="hljs-string">' {0}'</span>.format(others[j]);
				}
				<span class="hljs-keyword">else</span>
				{
					msg+=<span class="hljs-string">' {0},'</span>.format(others[j]);
				}				
			}			
		}
		<span class="hljs-keyword">else</span>
		{
			msg+=<span class="hljs-string">' {0}'</span>.format(others[<span class="hljs-number">0</span>]);
		}
		msg+=<span class="hljs-string">" for lunch. Let's meet {0} at {1} {2}. Bon appétit!"</span>.format((others.length&gt;<span class="hljs-number">1</span>)? <span class="hljs-string">'them'</span>:<span class="hljs-string">'him/her'</span>,time,<span class="hljs-string">''</span>);
		<span class="hljs-built_in">console</span>.log(msg);
	}
}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>When only 1 person signs up for a specific time, this message will be sent.
‘Hey @someone! You signed up for lunch at 13:30. 
Sorry to say, but nobody else signed up for this timeslot. 
Don’t worry, I’m sure, that you can find some buddies to have lunch with. :]’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendAlternativeMessage</span><span class="hljs-params">(name_list,time)</span>
</span>{
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hey {0}! You signed up for lunch at {1}. \
Sorry to say, but nobody else signed up for this timeslot. \
Don\'t worry, I\'m sure, that you can find some buddies to have lunch with. :]'</span>.format(name_list[<span class="hljs-number">0</span>],time) );
}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>This function forms groups from the arrays,
normally each group has 4 members, so
if it’s not possible it tries to create equal groups from those who remains (the last &lt;8 person)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createGroupsAndSend</span><span class="hljs-params">(time_array)</span>
</span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> time_array)
	{
		<span class="hljs-keyword">var</span> name_list=time_array[key];
		<span class="hljs-keyword">while</span> (name_list.length&gt;<span class="hljs-number">8</span>)
		{
			<span class="hljs-keyword">var</span> i;
			<span class="hljs-keyword">var</span> group=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
			<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)
			{
				group.push(name_list.pop());
			}
			sendMsg(group,key);
		}
		<span class="hljs-keyword">if</span> (name_list.length&gt;<span class="hljs-number">4</span>)
		{
			<span class="hljs-keyword">var</span> i;
			<span class="hljs-keyword">var</span> group=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
			<span class="hljs-keyword">var</span> half_size=<span class="hljs-built_in">Math</span>.floor(name_list.length/<span class="hljs-number">2</span>)
			<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;half_size;i++)
			{
				group.push(name_list.pop());
			}
			sendMsg(group,key);
		}
		<span class="hljs-keyword">if</span> (name_list.length&gt;<span class="hljs-number">1</span>)
		{
			sendMsg(name_list,key);
		}
		<span class="hljs-keyword">else</span>
		{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This case there’s only one person in the given timeslot.
We couldn’t decide how to handle this case properly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			sendAlternativeMessage(name_list,key);
		}
	}
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Receives a list of names with the associated timeslot and
returns a JSON object where each timeslot is associated with a list of names.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">date_list</span><span class="hljs-params">(store)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Please note the ‘ret’ stands for return variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> ret={}; 
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> store)
	{
		<span class="hljs-keyword">var</span> timeval=store[key];

		<span class="hljs-keyword">if</span> (timeval <span class="hljs-keyword">in</span> ret) {
			ret[timeval].push(key);
		}
		<span class="hljs-keyword">else</span> {
			ret[timeval]=[key];
		}
	}
	<span class="hljs-built_in">console</span>.log(ret);
	<span class="hljs-keyword">return</span> ret;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The “main” part of the file where the previous functions are called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">module</span>.parent) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>default input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  	<span class="hljs-keyword">var</span> inf=<span class="hljs-string">'input0.txt'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>This is for arg parsing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	process.argv.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val, index, array)</span> </span>{
	  <span class="hljs-keyword">if</span> (index==<span class="hljs-number">2</span>)
	  {
	  	inf=val;
	  }
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>And including the store variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	include(inf);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>So it first creates the namelist for the different timeslots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> time_arrays=date_list(store);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Then it shuffles each array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	time_arrays=shuffleTimeArray(time_arrays);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>So it can forms groups and sends the messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	createGroupsAndSend(time_arrays);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>//This is just for test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> time_arrays)
	{
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'{0}: {1}'</span>.format(key,time_arrays[key]));
	}

}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>for Mocha unit test located in spec directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports.date_list = date_list;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
